<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>공지사항 상세</title>
    <link rel="stylesheet" th:href="@{/css/user-notice.css(v=${#dates.format(#dates.createNow(), 'yyyyMMddHHmmss')})}">
</head>
<body>
    <div class="notice-container-detail">
        <div class="notice-detail-header">
            <img src="/images/Logo.png" alt="로고" class="notice-logo" onclick="goToMainPage()" style="cursor: pointer;" />
            <h2 class="notice-detail-title-header">공지사항</h2>
        </div>
        
        <div class="notice-detail-card">
            <div class="notice-detail-title">[[${notice.title}]]</div>
            
            <div class="notice-detail-info">
                <div class="info-item">
                    <div class="info-label">작성일</div>
                    <div class="info-value">[[${#temporals.format(notice.createdAt, 'yyyy-MM-dd')}]]</div>
                </div>
                <div class="info-item">
                    <div class="info-label">수정일</div>
                    <div class="info-value">[[${#temporals.format(notice.updatedAt, 'yyyy-MM-dd')}]]</div>
                </div>
                <div class="info-item">
                    <div class="info-label">조회수</div>
                    <div class="info-value">[[${notice.viewCount}]]</div>
                </div>
            </div>
            
            <div class="notice-detail-content">
                [[${notice.content}]]
            </div>
            
            <!-- 이전/다음 공지사항 (등록일 기준) -->
            <div class="notice-navigation">
                <div class="nav-item">
                    <span class="nav-label">다음글</span>
                    <a class="nav-title" th:if="${nextNotice}" th:href="@{/notice/{id}(id=${nextNotice.id})}" th:text="${nextNotice.title}"></a>
                    <span class="nav-title nav-disabled" th:unless="${nextNotice}">다음 공지사항이 없습니다.</span>
                </div>
                <div class="nav-item">
                    <span class="nav-label">이전글</span>
                    <a class="nav-title" th:if="${prevNotice}" th:href="@{/notice/{id}(id=${prevNotice.id})}" th:text="${prevNotice.title}"></a>
                    <span class="nav-title nav-disabled" th:unless="${prevNotice}">이전 공지사항이 없습니다.</span>
                </div>
            </div>
            
            <a href="javascript:void(0)" class="btn-list" onclick="goBackToList()">목록으로</a>
        </div>
    </div>
    <script>
        async function goBackToList() {
            try {
                // 현재 공지사항 ID 가져오기
                const currentNoticeId = [[${notice.id}]];
                
                // 전체 공지사항 목록 조회
                const response = await fetch('/api/user/notices');
                const notices = await response.json();
                
                // 현재 공지사항의 인덱스 찾기
                const currentIndex = notices.findIndex(notice => notice.id === currentNoticeId);
                
                if (currentIndex !== -1) {
                    // 페이지 번호 계산 (10개씩 한 페이지)
                    const itemsPerPage = 10;
                    const targetPage = Math.floor(currentIndex / itemsPerPage) + 1;
                    
                    // 계산된 페이지로 이동
                    localStorage.setItem('currentNoticePage', targetPage.toString());
                    window.location.href = '/notices?page=' + targetPage;
                } else {
                    // 찾지 못한 경우 기본 페이지로
                    const savedPage = localStorage.getItem('currentNoticePage') || '1';
                    window.location.href = '/notices?page=' + savedPage;
                }
            } catch (error) {
                console.error('페이지 계산 오류:', error);
                // 오류 시 기본 페이지로
                const savedPage = localStorage.getItem('currentNoticePage') || '1';
                window.location.href = '/notices?page=' + savedPage;
            }
        }
        
        function goToMainPage() {
            // 페이지네이션을 1로 초기화하고 메인페이지로 이동
            localStorage.setItem('currentNoticePage', '1');
            window.location.href = '/notices';
        }
    </script>
</body>
</html>