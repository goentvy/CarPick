<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.carpick.domain.member.mapper.ReservationHistoryMapper">

    <select id="selectMyHistory" resultType="com.carpick.domain.member.dto.ReservationHistoryResponse">
        SELECT
            id,
            CONCAT('RP-', DATE_FORMAT(created_at, '%Y%m%d'), '-', LPAD(id, 3, '0')) AS reservationCode,
            action_type AS type,
            COALESCE(old_car_name, 'Unknown') AS carName,
            old_car_name AS previousCar,
            new_car_name AS newCarName,
            CONCAT(DATE_FORMAT(old_start_date, '%Y.%m.%d'), ' ~ ', DATE_FORMAT(old_end_date, '%Y.%m.%d')) AS period,
            reason
        FROM reservation_history
        WHERE user_id = #{userId}
        ORDER BY created_at DESC
    </select>

</mapper>
