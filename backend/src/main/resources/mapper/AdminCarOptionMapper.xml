<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.carpick.admin.carAdmin.mapper.AdminCarOptionMapper">

    <resultMap id="AdminCarOptionResultMap" type="com.carpick.admin.carAdmin.dto.AdminCarOptionDto">
        <id property="optionId" column="option_id"/>
        <result property="optionName" column="option_name"/>
        <result property="optionDescription" column="option_description"/>
        <result property="optionDailyPrice" column="option_daily_price"/>
        <result property="isHighlight" column="is_highlight"/>
        <result property="useYn" column="use_yn"/>
        <result property="updatedAt" column="updated_at"/>
    </resultMap>

    <sql id="optionColumns">
        option_id, option_name, option_description,
        option_daily_price, is_highlight, use_yn, updated_at
    </sql>

    <sql id="optionInsertColumns">
        option_name, option_description,
        option_daily_price, is_highlight, use_yn
    </sql>

    <sql id="optionInsertValues">
        #{optionName}, #{optionDescription},
        #{optionDailyPrice}, #{isHighlight}, 'Y'
    </sql>

    <!-- 전체 목록 조회 -->
    <select id="selectList" resultMap="AdminCarOptionResultMap">
        SELECT <include refid="optionColumns"/>
        FROM CAR_OPTION
        WHERE use_yn = 'Y'
        ORDER BY updated_at DESC
    </select>

    <!-- 단건 조회 -->
    <select id="selectById" parameterType="long" resultMap="AdminCarOptionResultMap">
        SELECT <include refid="optionColumns"/>
        FROM CAR_OPTION
        WHERE option_id = #{optionId}
    </select>

    <!-- 등록 -->
    <insert id="insert" parameterType="com.carpick.admin.carAdmin.dto.AdminCarOptionDto"
            useGeneratedKeys="true" keyProperty="optionId">
        INSERT INTO CAR_OPTION (
        <include refid="optionInsertColumns"/>
        ) VALUES (
        <include refid="optionInsertValues"/>
        )
    </insert>

    <!-- 수정 -->
    <update id="update" parameterType="com.carpick.admin.carAdmin.dto.AdminCarOptionDto">
        UPDATE CAR_OPTION
        SET option_name = #{optionName},
            option_description = #{optionDescription},
            option_daily_price = #{optionDailyPrice},
            is_highlight = #{isHighlight},
            updated_at = NOW()
        WHERE option_id = #{optionId} AND use_yn = 'Y'
    </update>

    <!-- Soft Delete -->
    <update id="softDelete" parameterType="long">
        UPDATE CAR_OPTION
        SET use_yn = 'N', deleted_at = NOW()
        WHERE option_id = #{optionId}
    </update>

    <!-- 삭제된 데이터 중 같은 이름 있는지 체크 -->
    <select id="selectDeletedByName" parameterType="string" resultMap="AdminCarOptionResultMap">
        SELECT <include refid="optionColumns"/>
        FROM CAR_OPTION
        WHERE option_name = #{optionName}
        AND use_yn = 'N' LIMIT 1
    </select>

    <!-- 복구 -->
    <update id="restore" parameterType="long">
        UPDATE CAR_OPTION
        SET use_yn = 'Y', deleted_at = NULL,updated_at = NOW()
        WHERE option_id = #{optionId}
    </update>

</mapper>