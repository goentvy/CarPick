<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.carpick.domain.price.mapper.ReservationPriceDetailMapper">

    <insert id="insertPriceDetail"
            parameterType="com.carpick.domain.price.entity.ReservationPriceDetail"
            useGeneratedKeys="true"
            keyProperty="reservationPriceDetailId">

        INSERT INTO reservation_price_detail (
            reservation_id,

            reservation_rent_fee,
            reservation_insurance_fee,
            reservation_coupon_discount,
            reservation_total_amount,

            price_type,

            applied_daily_price,
            applied_hourly_price,
            applied_monthly_price,

            applied_days,
            applied_hours,
            applied_months,

            insurance_applied_days
        ) VALUES (
                     #{reservationId},

                     #{reservationRentFee},
                     #{reservationInsuranceFee},
                     #{reservationCouponDiscount},
                     #{reservationTotalAmount},

                     #{priceType},

                     #{appliedDailyPrice},
                     #{appliedHourlyPrice},
                     #{appliedMonthlyPrice},

                     #{appliedDays},
                     #{appliedHours},
                     #{appliedMonths},

                     #{insuranceAppliedDays}
                 )
            ON DUPLICATE KEY UPDATE
                                 reservation_rent_fee        = #{reservationRentFee},
                                 reservation_insurance_fee   = #{reservationInsuranceFee},
                                 reservation_coupon_discount = #{reservationCouponDiscount},
                                 reservation_total_amount    = #{reservationTotalAmount},

                                 price_type                  = #{priceType},

                                 applied_daily_price         = #{appliedDailyPrice},
                                 applied_hourly_price        = #{appliedHourlyPrice},
                                 applied_monthly_price       = #{appliedMonthlyPrice},

                                 applied_days                = #{appliedDays},
                                 applied_hours               = #{appliedHours},
                                 applied_months              = #{appliedMonths},

                                 insurance_applied_days      = #{insuranceAppliedDays}
    </insert>

    <select id="findStatementByReservationId"
            parameterType="java.lang.Long"
            resultType="com.carpick.domain.price.dto.ReservationPriceStatementResponseDto">

        SELECT
            reservation_rent_fee        AS rentFee,
            reservation_insurance_fee   AS insuranceFee,
            reservation_coupon_discount AS couponDiscount,
            reservation_total_amount    AS totalAmount,

            price_type                  AS priceType,

            applied_daily_price         AS appliedDailyPrice,
            applied_hourly_price        AS appliedHourlyPrice,
            applied_monthly_price       AS appliedMonthlyPrice,

            applied_days                AS appliedDays,
            applied_hours               AS appliedHours,
            applied_months              AS appliedMonths,

            insurance_applied_days      AS insuranceAppliedDays

        FROM reservation_price_detail
        WHERE reservation_id = #{reservationId}
    </select>

</mapper>