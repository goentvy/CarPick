<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">

<head>
	<meta charset="UTF-8">
	<title>카픽 - 공지사항</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- CSS -->
	<link rel="shortcut icon" type="image/png" th:href="@{/assets/images/icon/favicon.ico}">
	<link rel="stylesheet" th:href="@{/assets/css/bootstrap.min.css}">
	<link rel="stylesheet" th:href="@{/assets/css/font-awesome.min.css}">
	<link rel="stylesheet" th:href="@{/assets/css/common.css}">
	<link rel="stylesheet" th:href="@{/assets/css/themify-icons.css}">
	<link rel="stylesheet" th:href="@{/assets/css/owl.carousel.min.css}">
	<link rel="stylesheet" th:href="@{/assets/css/slicknav.min.css}">
	<link rel="stylesheet" th:href="@{/assets/css/typography.css}">
	<link rel="stylesheet" th:href="@{/assets/css/default-css.css}">
	<link rel="stylesheet" th:href="@{/assets/css/styles.css}">
	<link rel="stylesheet" th:href="@{/assets/css/responsive.css}">

	<script th:src="@{/assets/js/vendor/modernizr-2.8.3.min.js}"></script>
</head>

<body>
	<div class="page-container">

		<!-- 사이드바 -->
		<div th:replace="fragments/fragments :: sidebar"></div>

		<!-- 헤더 -->
		<div th:replace="fragments/fragments :: header"></div>

		<!-- 본문 -->
		<div class="main-content">

			<div class="page-title-area">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<div class="breadcrumbs-area clearfix">
							<h4 class="page-title pull-left">공지사항</h4>
							<ul class="breadcrumbs pull-left">
								<li><a th:href="@{/admin}">홈</a></li>
								<li><span>공지사항</span></li>
							</ul>
						</div>
					</div>
					<div class="col-sm-6 clearfix">
						<button class="user-profile user_writeBtn pull-right"
							onclick="location.href='/admin/notice/new'">
							공지사항 등록
						</button>
					</div>
				</div>
			</div>

			<!-- 검색 -->
			<form method="get" th:action="@{/admin/notice}" class="mb-3">
				<div class="search-box pull-left mr-1">
					<input type="text" name="keyword" th:value="${keyword}" placeholder="Search..." required>
				</div>
				<div class="search-btn">
					<button type="submit" class="btn btn-light mb-3">
						<i class="ti-search"></i>
					</button>
				</div>
			</form>

			<!-- 공지사항 목록 -->
			<div class="col-lg-12 mt-3">
				<div class="card">
					<div class="card-body">
						<h4 class="header-title">공지사항 관리</h4>

						<div class="single-table">
							<div class="table-responsive">
								<table class="table text-center table-bordered">
									<thead class="text-uppercase">
										<tr>
											<th style="width:60px;">NO</th>
											<th>제목</th>
											<th style="width:120px;">작성자</th>
											<th style="width:140px;">작성일</th>
											<th style="width:140px;">수정일</th>
											<th style="width:140px;">관리</th>
										</tr>
									</thead>
									<tbody>

										<tr th:if="${#lists.isEmpty(notices)}">
											<td colspan="6">등록된 공지사항이 없습니다.</td>
										</tr>

										<tr th:each="notice : ${notices}">
											<td th:text="${notice.id}">1</td>

											<td style="cursor:pointer;" th:text="${notice.title}"
												th:onclick="|location.href='/admin/notice/${notice.id}'|">
											</td>

											<td>관리자</td>

											<td th:text="${notice.createdAt != null 
                                            ? #temporals.format(notice.createdAt, 'yyyy-MM-dd') : ''}">
											</td>

											<td th:text="${notice.updatedAt != null 
									        ? #temporals.format(notice.updatedAt, 'yyyy-MM-dd') : ''}">
											</td>

											<td>
												<button class="btn btn-sm btn-outline-primary"
													th:onclick="|location.href='/admin/notice/edit/${notice.id}'|">
													수정
												</button>
												<button class="btn btn-sm btn-outline-danger"
													th:onclick="|deleteNotice(${notice.id})|">
													삭제
												</button>
											</td>
										</tr>

									</tbody>
								</table>
							</div>
						</div>

					</div>
				</div>
			</div>

			<!-- 페이징 -->
			<nav class="mt-3">
				<ul class="pagination justify-content-center">

					<li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
						<a class="page-link" th:href="@{/admin/notice(page=${currentPage - 1}, keyword=${keyword})}">
							이전
						</a>
					</li>

					<li class="page-item" th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
						th:classappend="${i == currentPage} ? 'active'">
						<a class="page-link" th:text="${i + 1}"
							th:href="@{/admin/notice(page=${i}, keyword=${keyword})}">
						</a>
					</li>

					<li class="page-item" th:classappend="${currentPage + 1 >= totalPages} ? 'disabled'">
						<a class="page-link" th:href="@{/admin/notice(page=${currentPage + 1}, keyword=${keyword})}">
							다음
						</a>
					</li>

				</ul>
			</nav>

		</div>

		<div th:replace="fragments/fragments :: footer"></div>
	</div>

	<!-- JS (⭐ 모든 admin 페이지와 통일) -->
	<script th:src="@{/assets/js/vendor/jquery-2.2.4.min.js}"></script>
	<script th:src="@{/assets/js/popper.min.js}"></script>
	<script th:src="@{/assets/js/bootstrap.min.js}"></script>
	<script th:src="@{/assets/js/metisMenu.min.js}"></script>
	<script th:src="@{/assets/js/jquery.slimscroll.min.js}"></script>
	<script th:src="@{/assets/js/jquery.slicknav.min.js}"></script>
	<script th:src="@{/assets/js/scripts.js}"></script>

	<script>
		function deleteNotice(id) {
			if (!confirm('정말 삭제하시겠습니까?')) return;

			fetch('/admin/notice/delete/' + id, {method: 'POST'})
				.then(() => location.reload());
		}
	</script>

</body>

</html>