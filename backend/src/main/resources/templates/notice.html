<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>카픽 - 공지사항 관리</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" th:href="@{/assets/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/assets/css/styles.css}">
	
	<link rel="stylesheet" th:href="@{/assets/css/admin-notice.css}">
</head>

<body>
<div class="page-container">

    <!-- 사이드바 / 헤더 -->
    <div th:replace="fragments/fragments :: sidebar"></div>
    <div th:replace="fragments/fragments :: header"></div>

    <div class="main-content">

        <!-- 타이틀 -->
        <div class="page-title-area mb-3">
            <div class="row align-items-center">
                <div class="col-sm-6">
                    <h4>공지사항 관리</h4>
                </div>
                <div class="col-sm-6 text-right">
                    <button class="btn btn-primary"
                            onclick="location.href='/admin/notice/new'">
                        공지사항 등록
                    </button>
                </div>
            </div>
        </div>

        <!-- 검색 -->
        <form method="get" th:action="@{/admin/notice}" class="mb-3">
            <div class="form-inline">
                <input type="text"
                       name="keyword"
                       class="form-control mr-2"
                       placeholder="검색"
                       th:value="${keyword}">
                <button type="submit" class="btn btn-secondary">검색</button>
            </div>
        </form>

        <!-- 공지사항 목록 -->
        <table class="table table-bordered text-center">
            <thead class="thead-light">
            <tr>
                <th style="width: 60px;">NO</th>
                <th>제목</th>
                <th style="width: 120px;">작성자</th>
                <th style="width: 140px;">작성일</th>
                <th style="width: 140px;">관리</th>
            </tr>
            </thead>
            <tbody>
            <tr th:if="${#lists.isEmpty(notices)}">
                <td colspan="5">등록된 공지사항이 없습니다.</td>
            </tr>

            <tr th:each="notice, stat : ${notices}">
                <td th:text="${stat.count}">1</td>

                <!-- 상세 이동 -->
                <td style="cursor:pointer; text-align:left;"
                    th:text="${notice.title}"
                    th:onclick="|location.href='/admin/notice/${notice.id}'|">
                </td>

                <!-- 관리자 고정 -->
                <td>관리자</td>

                <!-- 날짜 null-safe -->
                <td th:text="${notice.createdAt != null 
                    ? #temporals.format(notice.createdAt, 'yyyy-MM-dd') 
                    : ''}">
                </td>

                <!-- 관리 버튼 -->
                <td>
                    <button type="button"
                            class="btn btn-sm btn-outline-primary"
                            th:onclick="|location.href='/admin/notice/edit/${notice.id}'|">
                        수정
                    </button>
                    <button type="button"
                            class="btn btn-sm btn-outline-danger"
                            th:onclick="|deleteNotice(${notice.id})|">
                        삭제
                    </button>
                </td>
            </tr>
            </tbody>
        </table>

    </div>

    <!-- 삭제 스크립트 -->
    <script>
        function deleteNotice(id) {
            if (!confirm('정말 삭제하시겠습니까?')) return;

            fetch('/admin/notice/delete/' + id, {
                method: 'POST'
            }).then(() => location.reload());
        }
    </script>

    <div th:replace="fragments/fragments :: footer"></div>
</div>
</body>
</html>
