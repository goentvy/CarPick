<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">

<head>
	<meta charset="UTF-8">
	<title>카픽 - 일대일문의관리</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!-- CSS -->
	<link rel="shortcut icon" type="image/png" href="assets/images/icon/favicon.ico">
	<link rel="stylesheet" th:href="@{/assets/css/bootstrap.min.css}">
	<link rel="stylesheet" th:href="@{/assets/css/font-awesome.min.css}">
	<link rel="stylesheet" th:href="@{/assets/css/common.css}">
	<link rel="stylesheet" th:href="@{/assets/css/themify-icons.css}">
	<link rel="stylesheet" th:href="@{/assets/css/metisMenu.css}">
	<link rel="stylesheet" th:href="@{/assets/css/owl.carousel.min.css}">
	<link rel="stylesheet" th:href="@{/assets/css/slicknav.min.css}">

	<!-- Others CSS -->
	<link rel="stylesheet" th:href="@{/assets/css/typography.css}">
	<link rel="stylesheet" th:href="@{/assets/css/default-css.css}">
	<link rel="stylesheet" th:href="@{/assets/css/styles.css}">
	<link rel="stylesheet" th:href="@{/assets/css/responsive.css}">

	<!-- JS -->
	<script th:src="@{/assets/js/vendor/modernizr-2.8.3.min.js}"></script>
	
	<style>
	/* 필터 버튼을 버튼처럼 안 보이게 */
	.filter-btn {
	    background: none;
	    border: none;
	    padding: 0 4px;
	    font-size: 12px;
	    color: #aaa;
	    cursor: pointer;
	    box-shadow: none;
	}

	.filter-btn:hover {
	    color: #333;
	}

	/* 드롭다운 메뉴도 작게 */
	.dropdown-menu {
	    min-width: 110px;
	    font-size: 13px;
	    padding: 4px 0;
	}

	.dropdown-item {
	    padding: 4px 12px;
	}
	
	.table-responsive {
	    overflow: visible !important;
	}
	/* 선택된 필터 항목 표시 */
	.dropdown-item.active,
	.dropdown-item.active:hover {
	    background-color: #f1f1f1;
	    color: #333;
	    font-weight: 500;
		}
		.fixed-table {
		    table-layout: fixed;
		    width: 100%;
		}

		/* 헤더는 드롭다운 때문에 overflow 허용 */
		.fixed-table th {
		    white-space: nowrap;
		    overflow: visible !important;
		    position: relative;
		}

		/* 바디(td)는 말줄임표 유지 */
		.fixed-table td {
		    white-space: nowrap;
		    overflow: hidden;
		    text-overflow: ellipsis;
		}
		.card,
		.card-body,
		.single-table {
		    overflow: visible !important;
		}

		/* 드롭다운이 테이블 위로 뜨도록 */
		.dropdown {
		    position: relative;
		}

		/* 다른 요소보다 항상 위로 오게 */
		.dropdown-menu {
		    z-index: 9999;
		}
	</style>
	
	

</head>

<body>

	<div class="page-container">

		<!-- ⭐ 사이드바 include -->
		<div th:replace="fragments/fragments :: sidebar"></div>


		<!-- ⭐ header include -->
		<div th:replace="fragments/fragments :: header"></div>

		<!-- ⭐ 본문 영역 -->
		<!-- main content area start -->
		<div class="main-content">
			<!-- page title area start -->
			<div class="page-title-area">
				<div class="row align-items-center">
					<div class="col-sm-6">
						<div class="breadcrumbs-area clearfix">
							<h4 class="page-title pull-left">일대일문의 관리</h4>
							<ul class="breadcrumbs pull-left">
								<li><a href="/admin">홈</a></li>
								<li><span>일대일문의 관리</span></li>
							</ul>
						</div>
					</div>
					<div class="col-sm-6 clearfix">
					</div>
				</div>
			</div>
			<!-- page title area end -->
			<div class="main-content-inner">
				<form method="get" th:action="@{/admin/inquiry}">
					<div class="col-lg-12 mt-4">
						<div class="row">
							<div class="search-box pull-left mr-1">
								<input type="text" name="search" th:value="${search}" placeholder="제목 / 이메일 검색">
							</div>
							<div class="search-btn">
								<button type="submit" class="btn btn-light mb-3"><i class="ti-search"></i></button>
							</div>
							<a href="/admin/inquiry"
							   class="btn btn-light btn-sm"
							   style="margin-left:6px;"
							   title="필터 초기화">
							    <i class="fa fa-refresh"></i>
							</a>
						</div>
					</div>
				</form>
				<form id="filterForm" method="get" th:action="@{/admin/inquiry}">
				    <input type="hidden" name="search" th:value="${search}">
				    <input type="hidden" name="category" id="categoryInput" th:value="${category}">
				    <input type="hidden" name="status" id="statusInput" th:value="${status}">
					<input type="hidden" name="page" id="pageInput" value="0">
				</form>
				<div class="row mb-4">
					<!-- basic table start -->
					<div class="col-lg-12 mt-4">
						<div class="card">
							<div class="card-body">
								<h4 class="header-title">일대일문의 관리</h4>
								<div class="single-table">
									<div class="table-responsive">
										<table class="table text-center fixed-table">
											<thead class="text-uppercase">
												<tr>
													<th scope="col">NO</th>
													<th scope="col">이메일</th>
													<th scope="col">
													    문의유형
													    <div class="dropdown d-inline">
													        <button class="filter-btn dropdown-toggle"
													                type="button" data-toggle="dropdown">
													            ▼
													        </button>

													        <div class="dropdown-menu">
													            <a class="dropdown-item"
													               th:classappend="${category == null or category == ''} ? 'active' : ''"
													               href="#" onclick="setCategory('')">전체</a>
																   
																<a class="dropdown-item"
																   th:classappend="${category == 'longterm'} ? 'active' : ''"
																   href="#" onclick="setCategory('longterm')">장기렌트</a>
																   
													            <a class="dropdown-item"
													               th:classappend="${category == 'reservation'} ? 'active' : ''"
													               href="#" onclick="setCategory('reservation')">예약문의</a>

													            <a class="dropdown-item"
													               th:classappend="${category == 'payment'} ? 'active' : ''"
													               href="#" onclick="setCategory('payment')">결제문의</a>

													            <a class="dropdown-item"
													               th:classappend="${category == 'cancel'} ? 'active' : ''"
													               href="#" onclick="setCategory('cancel')">취소/환불</a>

													            <a class="dropdown-item"
													               th:classappend="${category == 'etc'} ? 'active' : ''"
													               href="#" onclick="setCategory('etc')">기타</a>
													        </div>
													    </div>
													</th>
													<th scope="col">문의제목</th>
													<th scope="col">
													    답변상태
													    <div class="dropdown d-inline">
													        <button class="filter-btn dropdown-toggle"
													                type="button" data-toggle="dropdown">
													            ▼
													        </button>

													        <div class="dropdown-menu">
													            <a class="dropdown-item"
													               th:classappend="${status == null or status == ''} ? 'active' : ''"
													               href="#" onclick="setStatus('')">전체</a>

													            <a class="dropdown-item"
													               th:classappend="${status == 'PENDING'} ? 'active' : ''"
													               href="#" onclick="setStatus('PENDING')">답변전</a>

													            <a class="dropdown-item"
													               th:classappend="${status == 'ANSWERED'} ? 'active' : ''"
													               href="#" onclick="setStatus('ANSWERED')">답변완료</a>
													        </div>
													    </div>
													</th>
													<th scope="col">관리</th>
												</tr>
											</thead>
											<tbody>
												<tr th:if="${#lists.isEmpty(inquiries)}">
													<td colspan="6" class="text-center text-muted" style="padding: 30px;">
													    조회된 문의가 없습니다.
													</td>
												</tr>
												<tr th:each="inquiry : ${inquiries}">
													<td th:text="${inquiry.id}"></td>
													<td th:text="${inquiry.userEmail}"></td>
													<td>
														<span th:switch="${inquiry.category}">
															<span th:case="'longterm'">장기렌트</span>
															<span th:case="'reservation'">예약문의</span>
															<span th:case="'payment'">결제문의</span>
															<span th:case="'cancel'">취소/환불</span>
															<span th:case="'etc'">기타</span>
															<span th:case="*" th:text="${inquiry.category}"></span>
														</span>
													</td>
													<td>
													  <a th:href="@{/admin/inquiry/{id}(id=${inquiry.id})}"
													     th:text="${inquiry.title}"
													     class="text-dark text-decoration-none">
													  </a>
													</td>
													<td>
													  <span th:if="${inquiry.status.name() == 'PENDING'}"
													        class="text-primary">
													    답변전
													  </span>

													  <span th:if="${inquiry.status.name() == 'ANSWERED'}"
													        class="text-secondary">
													    답변완료
													  </span>
													</td>
													<td>
														<a th:if="${inquiry.status.name() == 'PENDING'}"
															th:href="@{/admin/inquiry/{id}(id=${inquiry.id})}"
															class="btn btn-outline-primary btn-sm">답변</a>

														<a th:if="${inquiry.status.name() == 'ANSWERED'}"
															th:href="@{/admin/inquiry/{id}(id=${inquiry.id})}"
															class="btn btn-outline-secondary btn-sm">수정</a>

														<form
															th:action="@{/admin/inquiry/{id}/delete(id=${inquiry.id})}"
															method="post" style="display:inline;">
															<button type="submit" class="btn btn-outline-danger btn-sm"
																onclick="return confirm('정말 삭제하시겠습니까?');">
																삭제
															</button>
														</form>
													</td>
												</tr>
											</tbody>
										</table>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<nav aria-label="Page navigation example" th:if="${totalPages > 1}">
					<ul class="pagination justify-content-center">

						<!-- Previous -->
						<li class="page-item" th:classappend="${currentPage == 0} ? 'disabled' : ''">
							<a class="page-link"
							   th:href="${currentPage > 0}
							       ? @{/admin/inquiry(page=${currentPage - 1},
							                          search=${search},
							                          category=${category},
							                          status=${status})}
							       : '#'" tabindex="-1">
								Previous
							</a>
						</li>

						<!-- Page numbers -->
						<li class="page-item" th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
							th:classappend="${i == currentPage} ? 'active' : ''">
							<a class="page-link"
							   th:href="@{/admin/inquiry(page=${i},
							                             search=${search},
							                             category=${category},
							                             status=${status})}"
							   th:text="${i + 1}"
							   th:style="${i == currentPage}
							       ? 'background-color: #e3f2fd; color: #1976d2; border-color: #bbdefb;'
							       : ''">
							</a>
						</li>

						<!-- Next -->
						<li class="page-item" th:classappend="${currentPage >= totalPages - 1} ? 'disabled' : ''">
							<a class="page-link"
							   th:href="${currentPage < totalPages - 1}
							       ? @{/admin/inquiry(page=${currentPage + 1},
							                          search=${search},
							                          category=${category},
							                          status=${status})}
							       : '#'">
								   Next
								      </a>
						</li>

					</ul>
				</nav>
			</div>

			<!-- ⭐ footer include -->
			<div th:replace="fragments/fragments :: footer"></div>

		</div>

		<!-- jquery latest version -->
		<script th:src="@{/assets/js/vendor/jquery-2.2.4.min.js}"></script>

		<!-- bootstrap 4 js -->
		<script th:src="@{/assets/js/popper.min.js}"></script>
		<script th:src="@{/assets/js/bootstrap.min.js}"></script>

		<script th:src="@{/assets/js/owl.carousel.min.js}"></script>
		<script th:src="@{/assets/js/metisMenu.min.js}"></script>
		<script th:src="@{/assets/js/jquery.slimscroll.min.js}"></script>
		<script th:src="@{/assets/js/jquery.slicknav.min.js}"></script>

		<!-- others plugins -->
		<script th:src="@{/assets/js/plugins.js}"></script>
		<script th:src="@{/assets/js/scripts.js}"></script>
		<script>
		function setCategory(value) {
		    document.getElementById("categoryInput").value = value;
			document.getElementById("pageInput").value = 0;
		    document.getElementById("filterForm").submit();
		}

		function setStatus(value) {
		    document.getElementById("statusInput").value = value;
			document.getElementById("pageInput").value = 0;
		    document.getElementById("filterForm").submit();
		}
		</script>
</body>

</html>